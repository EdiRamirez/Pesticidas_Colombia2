--- 
title: "PREDICCIÓN PARA EL PRECIO DE IMPORTACIÓN DE LOS PESTICIDAS"
author: "Luis Felipe Ramírez Amariz, Edisson Miguel Ramírez Méndez y David López Gómez"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
output: bookdown::gitbook
documentclass: book
bibliography: [book.bib, packages.bib]
biblio-style: apalike
link-citations: yes
github-repo: rstudio/bookdown-demo
description: "PREDICCIÓN PARA EL PRECIO DE IMPORTACIÓN DE LOS PESTICIDAS."
---

# Unidad 1


<!--chapter:end:index.Rmd-->

## Predicción para el precio de importación de pesticidas en Colombia

El sector agrícola ha experimentado un incremento permanente en los precios al consumidor durante los últimos años. Esto puede ser asociado a varios factores, pero el que vale la pena mencionar en esta parte del desarrollo del proyecto es el incremento en el valor en la tasa de cambio y su impacto en la fluctuación del precio de los insumos importados. El sector agrícola depende de pesticidas importados para su producción, y el comportamiento en los últimos años en el precio de la tasa representativa del mercado (TRM), ha encarecido la compra de estos bienes. Un ejemplo de cómo afecta esta situación al sector agrícola se ve reflejado en un informe de Fedepapa donde se afirma que el alza de    todos los insumos importados llevó a que la producción de una hectárea de papa en noviembre del 2022 llegara a costar $34 millones mientras que en el 2021 tenía un valor de $22 millones de pesos 

## Formulación del problema
¿Como pronosticar un precio promedio de los pesticidas seleccionados, a partir de las técnicas y herramientas que ofrece las ciencias de datos?

## La ciencia de Datos (DS)
En un entorno tan competitivo como el que se enfrenta en la actualidad, las organizaciones, gremios e instituciones de cualquier tipo requieren de estrategias innovadoras para poder adaptarse a los fuertes cambios del presente y obtener fuertes conocimientos a partir de los datos e información disponible, es una muy buena estrategia para poder tomar decisiones pertinentes y administrar estos conjuntos de datos potencialmente invaluables.
Se puede definir la DS, como la aplicación de métodos cualitativos y cuantitativos para predecir resultados y solucionar problemas relevantes que atiendan a la creciente e inmensa cantidad de datos que existe actualmente y que se tienen disponibles. En la actualidad hay muchos algoritmos para el procesamiento y extracción de datos, DS proporciona a los profesionales una estructura y un conjunto de principios que dan un marco para tratar sistemáticamente los problemas de extracción de conocimiento útil de los datos [6]. A continuación, se abordará una breve definición de los principales principios de DS que se consideran relevantes para poder desarrollar la propuesta de este proyecto.
Para efectos de este proyecto, se propone utilizar algunas de las herramientas más de la DS, para así poder encontrar un modelo tal que estime el precio de un bien, para este caso algunos de los pesticidas importados en Colombia, que facilite la toma de decisiones en el sector agrícola y transcienda en el mercado internacional. 

<!--chapter:end:01-Propuesta.Rmd-->


## Los Datos
Los datos se encuentran alojados en la página de la Dian. Estas bases estadísticas de Comercio Exterior comprenden el movimiento legal de mercancías que ingresan o salen del territorio aduanero nacional -TAN- a través de las diferentes aduanas del país, desde o hacia otros países y zonas francas del territorio nacional; a esta información se le ha aplicado filtros, ajustes estadísticos y lineamientos metodológicos estadísticos nacionales e internacionales, respecto de las operaciones de Comercio Exterior de Bienes, dando cumplimiento a los principios de transparencia y acceso a la información pública, sin perjuicio del cumplimiento de las normas vigentes en materia de protección de datos personales, los Principios Fundamentales de las Estadísticas Oficiales de las Naciones Unidas y el Código Nacional de Buenas Prácticas del Sistema Estadístico Nacional del Departamento Administrativo Nacional de Estadística -DANE. (Nacionales, s.f.)
Este conjunto de datos se extrajo y se estructuró únicamente con las partidas arancelarias que hacen parte de los pesticidas que se modelarán.

## Creación del Dataset

Una vez que los datos fueron extraídos, se procedió a la creación del conjunto de datos. Esto implicó organizar la información en un formato estructurado que fuera adecuado para su posterior análisis. Se asignaron etiquetas y se verificó la coherencia de los datos para garantizar su calidad.
En este punto se realizó ajuste a las variables determinando las que mayor información generan para el análisis que se espera y dejando las de la información de nombres de importador y exportador, departamentos de destino, el peso neto, valor de la transacción de dólares, la descripción de la mercancía, la tasa de cambio, así como la fecha de presentación y partiendo de estos datos base, se crea la variable valor por kilo en la que se divide el valor FOB de la transacción sobre el peso que indica la importación tratando de definir para cada entrada al país de mercancía el valor de cada Kilo. 
Se agrega adicional la descripción de la partida arancelaria indicando las que son Insecticidas, herbicidas y fungicidas para el análisis posterior. 

## Limpieza de los Datos
En esta fase, se llevó a cabo un proceso exhaustivo de limpieza de los datos. Se identificaron y corrigieron posibles errores, valores atípicos y datos faltantes. Además, se aplicaron técnicas de normalización y estandarización para asegurar la consistencia y la fiabilidad de los datos.
En este punto se realiza la homologación de los importadores que en el análisis resultan ser los de mayor importancia y más volumen de importaciones generan ya que en algunos casos están escritos de manera diferente haciendo referencia a la misma empresa y en otros, por investigación de estas empresas, logramos determinar que hasta determinado año tenían una razón social diferente. Más adelante describiremos estas uniones y compras de compañías que hacen dinámico el mercado general de los pesticidas en Colombia. 

Se obtuvo un Dataset robusto con 60.401 observaciones y 11 variables a partir de la minería de los datos, se realizaron algunos cálculos referentes al proceso exploratorio de los datos logrando encontrar correlaciones y consiguiendo identificar patrones entre las variables para corregir problemas de sesgo.

<!--chapter:end:02-Fuente.Rmd-->

---
title: "Data"
author: ""
date: "2024-05-04"
output: html_document
---

# Unidad 2

<h2>Actividad 2</h2>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# Cargar el paquete si aún no lo tienes cargado
library(openxlsx)

# Leer el archivo Excel que ya tienes cargado
datos <- read.xlsx("importacionestriadadef.xlsx")

```

<h3>Selección de datos</h3>

<p>Se realiza analisis de la informacion de los diferente importadores de pesticidas, se encuentran diversas empresas importadoras y con diversos componentes o prodcutos a importar. al evaluar se identifica que la empresa TRIADA EMA S.A. SUCURSAL COLOMBIA importa un producto llamado Cosmo-Oil que hace parte del grupo de insecticidas, se tienen registros desde el 2010 al 2016, para un total de 73 registros.</p>

```{r cars}
summary(datos)
```

<p>De total de los datos se seleccionan los campos "Fecha_Presentación" y "Valor_FOB_USD", este ultimo corresponde al precio por kilo del insecticida.</p>

```{r pressure, echo=FALSE}
datos_ts <- datos[, c("FECHA_PRESENTACION", "VALOR_FOB_USD")]

#datos_ts

```

<p>Al importar los datos de excel se requiere organizarlos en orden ascendente de acuerdo a la fecha.</p>

```{r}

# Cargar el paquete
library(dplyr)
library(zoo)
library(forecast)

datos_ts <- arrange(datos_ts,(FECHA_PRESENTACION))

#datos_ts
```

</p>

<h3>Media Movil</h3>

<p>Para realizar analisìs de tendencia se realiza un promedio movil con k=5 de la variable Valor_FOB_USD y se crea un data set llamado prom_mov.</p>

```{r}
prom_mov=ma(datos_ts$VALOR_FOB_USD,order = 5, centre = FALSE)
prom_mov
```

<p>Los datos que son parte del analisis de serie de tiempos (Cosmo_oil) se transforma en serie de tiempo, iniciando desde el años 2010 y estos estas distribuidos de manera mensual.</p>

```{r}
serie=ts(data=datos_ts, start = 2010,frequency =12 )
#serie
```

<p>Para tener los datos con solo la serie de tiempo y el valor en dolares del kilo de insecticida, se elimina el campo fecha que viene del archivo original.</p>

```{r}
precios_ts=ts(serie[,2],start = 2010,frequency = 12)
precios_ts
#plot(precios_ts)
```

```{r}
#install.packages("tidyverse")
#install.packages("forecast")
#install.packages("purrr")

library(purrr)
library(tidyverse)

```

<p>La secuencia de promedio movil se convierte en serie de tiempo usando la instrucciòn "ts"</p>

```{r}
preciosMV_ts=ts(prom_mov,start = 2010,frequency = 12)
preciosMV_ts
#plot(preciosMV_ts)

```

</p>

```{r}
#install.packages("fpp2")
library(fpp2)

#install.packages("fpp")
library(fpp)

```

</p>

Se realiza grafica del precio del insecticida y se incluye el comportamiento de la media movil usando valor de K=5

</p>

```{r}



autoplot(precios_ts, series="USD/Kilo") +
  autolayer(preciosMV_ts,series = "Prom_Mov_5") + ylab("USD/Kilo")+ xlab("tiempo")


```

```{r}
serie_rezago_1 <- stats::lag(precios_ts, k=1)
serie_rezago_2 <- stats::lag(precios_ts, k=2)

serie_rezago_1
serie_rezago_2
```

<h3>Tendencia</h3>

<p>

Realizando una evaluaciòn de la grafica anterior se observa:

<ul>

<li>Al finalizar el año el precio del insecticida tiende a subir, lo cual puede ser una estacionalidad en los datos.</li>

<li>Al finalizar el 2015 el precio tiende a bajar</li>

<li>Se observa un incremento al finalizar el 2011</li>

<li>Entre el 2011 y 2025 se tiene valores similares</li>

</ul>

</p>

```{r}

autoplot(precios_ts, series="USD/Kilo") + autolayer(preciosMV_ts,series = "Prom_Mov_5") + autolayer(serie_rezago_1, series="Rezago_1") + autolayer(serie_rezago_2, series="Rezago_2")+ ylab("USD/Kilo")+ xlab("tiempo")

```

# Unidad 3

<h2>Actividad 3</h2>

<p>Se debe documentar la descomposiciòn, la estacinariedad y la diferenciaciòn</p>

<h3>Descomposión</h3>

Se realiza grafica de descomposicion de:

<ul>

<li>Tendencia.</li>

<li>Estacionalidad</li>

<li>Residuo</li>

</ul>

```{r}
fit <-decompose(precios_ts,type = "additive")
library(ggfortify)

autoplot(fit)+labs(title = "Descomposición de la serie de tiempo",
                   x="tiempo",
                   y="Valor USD/Kilo",
                   colour="gears")+
  theme_bw()
```

<p>Se observa que hay tendecia al inicio y final de la serie. Con el fin de evaluar la estacionalidad se debe realizar grafica y prueba de Dickey-Fuller</p>

<h3>Estacionalidad</h3>

```{r}
ggseasonplot(precios_ts)
```

<h3>Prueba de Dickey- Fuller</h3>

```{r}
adf_usd <- adf.test(precios_ts)
adf_usd
```

<p>

Dado que el valor p (0.08223) es mayor que un nivel de significancia común como 0.05, no hay suficiente evidencia para rechazar la hipótesis nula de que la serie de tiempo tiene raíces unitarias, lo que sugiere que la serie de tiempo es no estacionaria. Sin embargo, es importante tener en cuenta que el valor p está cerca del nivel de significancia, por lo que podría haber una tendencia hacia la estacionariedad, como lo menciona el resultado "stationary"

Ante este resultado la serie de tiempo se considerarà no estacionaria

Con el fin de identificar la necesidad de validar la necesidad de realizar un ajuste de estacionalidad se hace la prueba ndiffs. el resultado es uno, por lo tanto se realizarà una transformaciòn

</p>

```{r}
ndiffs(precios_ts)
```

```{r}
#Funcion de autocorrelacion
acf(precios_ts)
```

<p>al realizar un proceso de diferenciaciòn se valida, que ya no es necesario realizar una nueva</p>

```{r}
#usar diferenciacion

seriedif=diff(precios_ts)
#plot(seriedif)
#acf(seriedif)
ndiffs(seriedif)


```

<p>Se tiene como resultado una serie de tiempo estacional y se puede apreciar al comparar los graficos antes y despues del ajuste diferenciado.</p>

```{r}

par(mfrow=c(2,2),mar=c(4,4,4,1)+.1)
plot(precios_ts,ylab="USD/Kilo")
acf(precios_ts,main="Serie No Estacionaria")
plot(seriedif)
acf(seriedif,main="Serie Estacionaria")

```

```{r}
summary(datos)

Sumario = summary(datos)

capture.output(Sumario, file="Sumario.doc")
```

<!--chapter:end:03-Data.Rmd-->

---
title: "Holt-Winter"
author: ""
date: "2024-05-17"
output: html_document
---

# Unidad 4

<h2>Actividad 4</h2>


Importar paquetes:

```{r}
library(vars)
library(TSA)
```
<p>Cargar los datos</p>

```{r}
# Cargar el paquete si aún no lo tienes cargado
library(openxlsx)

# Leer el archivo Excel que ya tienes cargado
datos <- read.xlsx("importacionestriadadef.xlsx")
summary(datos)

```


<p>De total de los datos se seleccionan los campos "Fecha_Presentación" y "Valor_FOB_USD", este ultimo corresponde al precio por kilo del insecticida.</p>

Se reestablece el formato fecha para trabajar con los datos

```{r pressure, echo=FALSE}
datos_ts <- datos[, c("FECHA_PRESENTACION", "VALOR_FOB_USD")]
datos_ts$FECHA_PRESENTACION <- as.Date(datos_ts$FECHA_PRESENTACION, origin = "1899-12-30")
#datos_ts

```

<p>Al importar los datos de excel se requiere organizarlos en orden ascendente de acuerdo a la fecha.</p>

```{r}

# Cargar el paquete
library(dplyr)
library(zoo)
library(forecast)

datos_ts <- arrange(datos_ts,(FECHA_PRESENTACION))

#datos_ts
```

<p>Los datos que son parte del analisis de serie de tiempos (Cosmo_oil) se transforma en serie de tiempo, iniciando desde el años 2010 y estos estas distribuidos de manera mensual.</p>

```{r}
serie=ts(data=datos_ts, start = 2010,frequency =12 )
#serie
```

<p>Para tener los datos con solo la serie de tiempo y el valor en dolares del kilo de insecticida, se elimina el campo fecha que viene del archivo original.</p>

```{r}
precios_ts=ts(serie[,2],start = 2010,frequency = 12)
precios_ts
#plot(precios_ts)
```

```{r}
#install.packages("tidyverse")
#install.packages("forecast")
#install.packages("purrr")

library(purrr)
library(tidyverse)

```

<p>La secuencia de promedio movil se convierte en serie de tiempo usando la instrucciòn "ts"</p>

```{r}
preciosMV_ts=ts(precios_ts,start = 2010, frequency = 12)
preciosMV_ts
#plot(preciosMV_ts)

```
<h3>Descomposiòn</h3>

Se realiza grafica de descomposicion de:

<ul>

<li>Tendencia.</li>

<li>Estacionalidad</li>

<li>Residuo</li>

</ul>

```{r}
fit <-decompose(preciosMV_ts,type = "additive")
library(ggfortify)

```

Graficamos la tendencia

```{r}
#datos_ts

str(precios_ts)
View(precios_ts)
plot(precios_ts)
summary(precios_ts)
class(precios_ts)

```
Observamos características


```{r}
#datos_ts

class(precios_ts)
start(precios_ts)
end(precios_ts)
frequency(precios_ts)
summary(precios_ts)

```

Observar tendencia y ciclos
```{r}
plot(precios_ts)
abline(reg=lm(precios_ts~time(precios_ts)))
cycle(precios_ts)
```

Observamos información de los meses en los datos

```{r}
boxplot(precios_ts~cycle(precios_ts))

```

Se observan valores de media similares en los meses, generando unas pequeñas diferencias entre los meses de marzo, abril y mayo en donde la variación es más alta y datos muy similares desde el mes de agosto hasta diciembre


Se agrega información logarítmica para observar mejor los datos
```{r}
plot(log(precios_ts), ylab="log(precios_ts)", xlab="Año", main="Logaritmo de precios")

```
## Aplicamos el modelo Holt-Winters
```{r}
modelo_HW=HoltWinters(log(preciosMV_ts), seasonal = "additive")
plot(modelo_HW, main="Ajuste con Holt-Winter", xlab="año", ylab="Logaritmo de precios")

```
Se observa una aproximación a los datos originales pero no es tan cercana

## Descomponer de acuerdo a características

```{r}
plot(fitted(modelo_HW), main = "Descomposición con HW", xlab = "Año", ylab = "Logaritmo de precios")

```
Realizamos corroboración del modelo partiendo de los datos que nos genere el modelo


```{r}
pred = predict(modelo_HW, 6, prediction.interval = TRUE)
pred
```

```{r}
plot(modelo_HW, pred)
```
La linea roja representa los valores generados por el modelo. Al momento de predecir, teniendo en cuenta los parámetros usados podemos pensar que aunque si genera un valor de predicción, no podemos comprara si el valor es ajustado a la realidad por la falta de datos y adicional, se vincula mucho con el dato anterior y al estar cercano a los valores reales en el 2012 pero tan alejados en el 2015 no se podría concluir realmente con esta información. 


<!--chapter:end:04-Unidad4.Rmd-->

---
title: "ARIMA"
author: ""
date: "2024-05-18"
output: html_document
---

# Unidad 5

<h2>Actividad 5</h2>


Importar paquetes:

```{r}
library(vars)
library(TSA)
```
<p>Cargar los datos</p>

```{r}
# Cargar el paquete si aún no lo tienes cargado
library(openxlsx)

# Leer el archivo Excel que ya tienes cargado
datos <- read.xlsx("importacionestriadadef.xlsx")
summary(datos)

```


<p>De total de los datos se seleccionan los campos "Fecha_Presentación" y "Valor_FOB_USD", este ultimo corresponde al precio por kilo del insecticida.</p>

Se reestablece el formato fecha para trabajar con los datos

```{r pressure, echo=FALSE}
datos_ts <- datos[, c("FECHA_PRESENTACION", "VALOR_FOB_USD")]
datos_ts$FECHA_PRESENTACION <- as.Date(datos_ts$FECHA_PRESENTACION, origin = "1899-12-30")
#datos_ts

```

<p>Al importar los datos de excel se requiere organizarlos en orden ascendente de acuerdo a la fecha.</p>

```{r}

# Cargar el paquete
library(dplyr)
library(zoo)
library(forecast)

datos_ts <- arrange(datos_ts,(FECHA_PRESENTACION))

#datos_ts
```

<p>Los datos que son parte del analisis de serie de tiempos (Cosmo_oil) se transforma en serie de tiempo, iniciando desde el años 2010 y estos estas distribuidos de manera mensual.</p>

```{r}
serie=ts(data=datos_ts, start = 2010,frequency =12 )
#serie
```

<p>Para tener los datos con solo la serie de tiempo y el valor en dolares del kilo de insecticida, se elimina el campo fecha que viene del archivo original.</p>

```{r}
precios_ts=ts(serie[,2],start = 2010,frequency = 12)
precios_ts
#plot(precios_ts)
```

```{r}
#install.packages("tidyverse")
#install.packages("forecast")
#install.packages("purrr")

library(purrr)
library(tidyverse)

```

<p>La secuencia de promedio movil se convierte en serie de tiempo usando la instrucciòn "ts"</p>

```{r}
preciosMV_ts=ts(precios_ts,start = 2010, frequency = 12)
preciosMV_ts
#plot(preciosMV_ts)

```
<h3>Descomposiòn</h3>

Se realiza grafica de descomposicion de:

<ul>

<li>Tendencia.</li>

<li>Estacionalidad</li>

<li>Residuo</li>

</ul>

```{r}
fit <-decompose(preciosMV_ts,type = "additive")
library(ggfortify)

```

Graficamos la tendencia

```{r}
#datos_ts

str(precios_ts)
View(precios_ts)
plot(precios_ts)
summary(precios_ts)
class(precios_ts)

```
Observamos características


```{r}
#datos_ts

class(precios_ts)
start(precios_ts)
end(precios_ts)
frequency(precios_ts)
summary(precios_ts)

```

Observar tendencia y ciclos
```{r}
plot(precios_ts)
abline(reg=lm(precios_ts~time(precios_ts)))
cycle(precios_ts)
```

Observamos información de los meses en los datos

```{r}
boxplot(precios_ts~cycle(precios_ts))

```

Se observan valores de media similares en los meses, generando unas pequeñas diferencias entre los meses de marzo, abril y mayo en donde la variación es más alta y datos muy similares desde el mes de agosto hasta diciembre


Se agrega información logarítmica para observar mejor los datos
```{r}
plot(log(precios_ts), ylab="log(precios_ts)", xlab="Año", main="Logaritmo de precios")

```

## Transformar a estacionaria

Procedemos a transformar nuestra serie, para que sea estacionaria, haciendo uso de la función adf.
```{r}
library(aTSA)

```
```{r}
adf.test(diff(log(precios_ts)))
```
Ajustamos
```{r}
library(forecast)
```

```{r}
modelo<-auto.arima(diff(log(precios_ts)))
```

```{r}
pronostico<- forecast::forecast(modelo,12)
plot(pronostico,main="Pronóstico con auto.arima",xlab="Año",ylab="log(airmiles)")
grid()

```

```{r}
residuales<-modelo$residuals
qqnorm(residuales)
qqline(residuales)
```

```{r}
shapiro.test(residuales)
```

```{r}
Box.test(residuales,type = "Ljung-Box")
```

Teniendo en cuenta la variación de los datos, la aproximación del modelo de predicción no es tan ajustado a lo esperado. 

<!--chapter:end:05-Unidad5.Rmd-->

---
title: "Prophet"
author: ""
date: "2024-05-25"
output: html_document
---

# Unidad 6

Actividad 6

Cargar los datos

```{r}
# Cargar el paquete si aún no lo tienes cargado
library(openxlsx)

# Leer el archivo Excel que ya tienes cargado
datos <- read.xlsx("importacionestriadadef.xlsx")
summary(datos)

```


Del total de los datos se seleccionan los campos "Fecha_Presentación" y "Valor_FOB_USD", este ultimo corresponde al precio por kilo del insecticida.

Se reestablece el formato fecha para trabajar con los datos

```{r pressure, echo=FALSE}
datos_ts <- datos[, c("FECHA_PRESENTACION", "VALOR_FOB_USD")]
datos_ts$FECHA_PRESENTACION <- as.Date(datos_ts$FECHA_PRESENTACION, origin = "1899-12-30")
#datos_ts

```

Al importar los datos de excel se requiere organizarlos en orden ascendente de acuerdo a la fecha

```{r}

# Cargar el paquete
library(dplyr)
library(zoo)
library(forecast)

datos_ts <- arrange(datos_ts,(FECHA_PRESENTACION))

datos_ts
```

Se cargan librerías para el análisis con el modelo

```{r}
library(ggplot2)
library(fpp3)
library(prophet)
```

Se cambian los nombres de las columnas para trabajar con el modelo

```{r}
colnames(datos_ts)[1] <-"ds"
colnames(datos_ts)[2] <-"y"
```

```{r}
plot(datos_ts)
```

Se ajustan los parámetros del modelo 

```{r}
Model1 <- prophet(datos_ts)
Future <- make_future_dataframe(Model1, periods = 365)
tail(Future)
```

Mostrar las primeras filas de las predicciones

```{r}
#Forecast
Pronostico <- predict(Model1, Future)
tail(Pronostico[c("ds", "yhat", "yhat_lower", "yhat_upper")])

```

A continuación, se crea una trama. Podemos ver que los datos de entrenamiento están representados como puntos negros y el pronóstico es una línea azul con límites superior e inferior en un área sombreada en azul.

Podemos ver que los años previstos coinciden bien con las observaciones reales, especialmente si se tienen en cuenta los límites.

```{r}
plot(Model1, Pronostico)
```


Para visualizar los componentes del modelo (tendencia, estacionalidad) se realiza visualización de estos componentes que nos da una idea del comportamiento de los datos anualmente y por día del año

```{r}
prophet_plot_components(Model1, Pronostico)
```

El pronóstico y las visualizaciones de los componentes muestran que Prophet pudo modelar con precisión la tendencia subyacente en los datos, al mismo tiempo que modeló con precisión la estacionalidad diaria y anual 

<!--chapter:end:06-Unidad6.Rmd-->

